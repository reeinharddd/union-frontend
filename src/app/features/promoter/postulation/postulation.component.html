<div class="mx-auto max-w-6xl p-6">
  <h2 class="mb-6 text-center text-2xl font-bold text-gray-800">Oportunidades con Candidatos</h2>

  <div class="mb-4">
    <label for="estadoFiltro" class="mr-2">Filtrar por estado:</label>
    <select
      id="estadoFiltro"
      [(ngModel)]="estadoSeleccionado"
      (change)="filtrarPostulaciones()"
      class="rounded border border-gray-300 p-2"
    >
      <option value="">Todos</option>
      <option value="pendiente">Pendiente</option>
      <option value="aceptada">Aceptada</option>
      <option value="rechazada">Rechazada</option>
    </select>
  </div>

  <div
    *ngFor="let oportunidad of oportunidades"
    class="mb-8 rounded-lg border bg-white p-6 shadow-md"
  >
    <h3 class="text-xl font-semibold text-gray-800">{{ oportunidad.titulo }}</h3>
    <p class="text-sm text-gray-600">
      Universidad: {{ universidadesMap[oportunidad.universidad_id] || 'N/A' }}
    </p>
    <p class="text-sm text-gray-600">
      Tipo: {{ tiposOportunidadMap[oportunidad.opportunity_type_id] || 'N/A' }}
    </p>
    <p class="text-sm text-gray-600">
      Modalidad: {{ modalidadesMap[oportunidad.modality_id] || 'N/A' }}
    </p>
    <p class="text-sm text-gray-600">Fecha límite: {{ oportunidad.fecha_limite }}</p>

    <div class="mt-4">
      <h4 class="mb-2 font-semibold text-gray-700">Postulaciones:</h4>

      <table class="min-w-full border text-sm">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2 text-left">Nombre</th>
            <th class="px-4 py-2 text-left">Correo</th>
            <th class="px-4 py-2 text-left">Fecha</th>
            <th>Acciones</th>
            <!-- Nueva columna -->
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let post of postulacionesFiltradas; let i = index">
            <td class="px-4 py-2">{{ post.nombre_usuario || 'Desconocido' }}</td>
            <td class="px-4 py-2">{{ post.correo_usuario || 'N/A' }}</td>
            <td class="px-4 py-2">{{ post.fecha | date }}</td>
            <td>
              <select
                [ngModel]="post.estado"
                (ngModelChange)="actualizarEstado(post.id, $event)"
                class="rounded border p-1"
              >
                <option value="pendiente">Pendiente</option>
                <option value="aceptada">Aceptada</option>
                <option value="rechazada">Rechazada</option>
              </select>
            </td>
          </tr>
        </tbody>
      </table>

      <ng-template #sinPostulaciones>
        <p class="text-sm text-gray-500">No hay usuarios postulados aún.</p>
      </ng-template>
    </div>
  </div>
</div>
