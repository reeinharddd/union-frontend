<!-- Fabian Mendoza -->
<div class="flex h-screen bg-gray-50" role="application">
  <!-- SIDEBAR como navegación -->
  <aside
    class="flex w-64 flex-col border-r border-gray-200 bg-white p-4"
    role="navigation"
    aria-label="Lista de páginas colaborativas"
  >
    <h2 class="sr-only">Páginas</h2>
    <ul role="menu" class="mb-4 space-y-1 overflow-auto">
      <li
        *ngFor="let page of pages()"
        (click)="selectPage(page)"
        [class.bg-gray-100]="page.id === selectedPage?.id"
        class="cursor-pointer rounded px-3 py-1 font-medium text-black hover:bg-gray-100"
        role="menuitem"
        [attr.aria-current]="page.id === selectedPage?.id ? 'page' : null"
        tabindex="0"
        (keydown.enter)="selectPage(page)"
      >
        {{ page.titulo }}
      </li>
    </ul>
    <button
      *ngIf="permiso() === 'edit'"
      (click)="selectPage(null)"
      class="mb-2 flex w-full items-center justify-center gap-2 rounded-2xl border-2 border-primary-200 bg-primary-500 py-3 text-lg font-bold text-white shadow-lg transition-all duration-150 hover:bg-primary-700 focus:outline-none focus:ring-4 focus:ring-primary-200"
      aria-label="Crear nueva página"
      style="margin-top: 0.5rem; margin-bottom: 1.5rem"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg>
      Nueva página
    </button>
  </aside>

  <!-- MAIN con landmark -->
  <main class="flex-1 overflow-auto p-8" role="main">
    <!-- Formulario de creación -->
    <ng-container *ngIf="showCreate() && permiso() === 'edit'; else pageView">
      <div class="mx-auto max-w-xl">
        <h2 class="mb-4 text-2xl font-bold text-black">Crear nueva página</h2>
        <div class="mb-4 flex items-center space-x-6" *ngIf="permiso() === 'edit'">
          <label class="font-semibold text-black">
            <input
              type="radio"
              name="modo"
              [value]="'view'"
              (change)="viewMode.set('view')"
              [checked]="viewMode() === 'view'"
            />
            Solo lectura
          </label>
          <label class="font-semibold text-black">
            <input
              type="radio"
              name="modo"
              [value]="'edit'"
              (change)="viewMode.set('edit')"
              [checked]="viewMode() === 'edit'"
            />
            Modo edición
          </label>
        </div>
        <input
          [(ngModel)]="newTitle"
          placeholder="Título"
          class="mb-2 w-full rounded border bg-gray-50 p-2 text-black"
        />
        <textarea
          [(ngModel)]="newDesc"
          placeholder="Descripción"
          class="mb-4 w-full rounded border bg-gray-50 p-2 text-black"
        ></textarea>
        <button
          (click)="createPage()"
          class="rounded bg-primary-500 px-4 py-2 font-bold text-white shadow-lg hover:bg-primary-700"
          [attr.aria-disabled]="!newTitle() || !newDesc()"
          [disabled]="!newTitle() || !newDesc()"
        >
          Guardar página
        </button>
        <button
          (click)="showCreate.set(false)"
          class="ml-2 px-4 py-2 text-gray-800 hover:underline"
        >
          Cancelar
        </button>
      </div>
    </ng-container>

    <!-- Vista de página seleccionada -->
    <ng-template #pageView>
      <ng-container *ngIf="selectedPage; else emptyState">
        <header class="mb-6">
          <h1 class="text-3xl font-bold text-black">{{ selectedPage.titulo }}</h1>
          <p class="text-gray-800">{{ selectedPage.descripcion }}</p>
        </header>
        <app-block-list-component
          [pageId]="selectedPage.id"
          [canEdit]="permiso() === 'edit'"
        ></app-block-list-component>
      </ng-container>
      <ng-template #emptyState>
        <p class="text-gray-800">Selecciona o crea una página para comenzar.</p>
      </ng-template>
    </ng-template>
  </main>
</div>
