<!-- Fabian Mendoza -->
<div class="flex h-screen bg-gray-50" role="application">

  <!-- SIDEBAR como navegación -->
  <aside
    class="w-64 bg-white border-r border-gray-200 p-4 flex flex-col"
    role="navigation"
    aria-label="Lista de páginas colaborativas"
  >
    <h2 class="sr-only">Páginas</h2>
    <ul role="menu" class="flex-1 overflow-auto space-y-1">
      <li
        *ngFor="let page of pages()"
        (click)="selectPage(page)"
        [class.bg-gray-100]="page.id === selectedPage?.id"
        class="cursor-pointer px-3 py-1 rounded hover:bg-gray-100"
        role="menuitem"
        [attr.aria-current]="page.id === selectedPage?.id ? 'page' : null"
        tabindex="0"
        (keydown.enter)="selectPage(page)"
      >
        {{ page.titulo }}
      </li>
    </ul>
    <button
      *ngIf="permiso() === 'edit'"
      (click)="selectPage(null)"
      class="mt-4 px-2 py-1 text-sm text-blue-600 hover:underline"
      aria-label="Crear nueva página"
    >
      + Nueva página
    </button>
  </aside>

  <!-- MAIN con landmark -->
  <main class="flex-1 p-8 overflow-auto" role="main">
    <!-- Formulario de creación -->
    <ng-container *ngIf="showCreateForm() && permiso() === 'edit'; else pageView">
      <div class="max-w-xl mx-auto">
        <h2 class="text-2xl mb-4">Crear nueva página</h2>
        <div class="flex items-center space-x-6 mb-4" *ngIf="permiso()==='edit'">
          <label>
            <input
              type="radio"
              name="modo"
              [value]="'view'"
              (change)="viewMode.set('view')"
              [checked]="viewMode() === 'view'"
            />  
            Solo lectura
          </label>
          <label>
            <input
              type="radio"
              name="modo"
              [value]="'edit'"
              (change)="viewMode.set('edit')"
              [checked]="viewMode() === 'edit'"
            />  
            Modo edición
          </label>
        </div>
        <input
          [(ngModel)]="newTitle"
          placeholder="Título"
          class="w-full mb-2 p-2 border rounded"
        />
        <textarea
          [(ngModel)]="newDesc"
          placeholder="Descripción"
          class="w-full mb-4 p-2 border rounded"
        ></textarea>
        <button
          (click)="createPage()"
          class="px-4 py-2 bg-green-600 text-white rounded"
          [attr.aria-disabled]="!newTitle() || !newDesc()"
          [disabled]="!newTitle() || !newDesc()"
        >
          Guardar página
        </button>
        <button
          (click)="showCreateForm.set(false)"
          class="ml-2 px-4 py-2 text-gray-600 hover:underline"
        >
          Cancelar
        </button>
      </div>
    </ng-container>

    <!-- Vista de página seleccionada -->
    <ng-template #pageView>
      <ng-container *ngIf="selectedPage; else emptyState">
        <header class="mb-6">
          <h1 class="text-3xl font-bold">{{ selectedPage.titulo }}</h1>
          <p class="text-gray-700">{{ selectedPage.descripcion }}</p>
        </header>
        <app-block-list
          [pageId]="selectedPage.id"
          [canEdit]="permiso() === 'edit'"
        ></app-block-list>
      </ng-container>
      <ng-template #emptyState>
        <p class="text-gray-500">
          Selecciona o crea una página para comenzar.
        </p>
      </ng-template>
    </ng-template>
  </main>
</div>
