<!-- Estado de carga -->
<div *ngIf="loading" class="p-4 text-center">
  <p class="text-gray-600">Cargando proyecto...</p>
</div>

<!-- Error -->
<div *ngIf="error" class="rounded-lg bg-red-50 p-4 text-center text-red-600">
  {{ error }}
</div>

<!-- Contenido del proyecto -->
<div *ngIf="project && (project.vista_publica || isProjectOwner) && !loading" class="space-y-6">
  <!-- Encabezado gris con estado -->
  <div class="relative rounded-t-xl bg-gray-200 p-6 shadow-sm">
    <div class="flex items-start justify-between">
      <div class="flex items-center gap-4">
        <div class="h-16 w-16 rounded-full bg-black"></div>
        <div>
          <h1 class="flex items-center gap-2 text-xl font-bold text-black sm:text-2xl">
            {{ project.nombre || 'Nombre completo proyecto' }}
            <span *ngIf="project.destacado" class="text-2xl text-yellow-400">⭐</span>
          </h1>
          <div class="mt-2">
            <span class="inline-block rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-800">
              Estado: {{ project.estado_verificacion || 'No especificado' }}
            </span>
          </div>
        </div>
      </div>
      <div class="flex flex-col items-center">
        <div class="h-10 w-10 rounded-full bg-black"></div>
        <span class="mt-1 text-[10px] text-gray-700">Nombre Univ</span>
      </div>
    </div>
    <!-- Línea negra debajo del encabezado -->
    <div class="mt-4 border-t border-black"></div>
  </div>

  <!-- Descripción -->
  <div class="rounded-lg border border-gray-300 bg-white p-4 shadow-sm">
    <h3 class="mb-2 font-medium text-gray-700">Descripción</h3>
    <p class="text-sm text-gray-700">
      {{ project.descripcion || 'Base/picio adatada' }}
    </p>
  </div>

  <!-- Sección de colaboradores -->
  <div class="rounded-lg border border-gray-200 bg-white p-4 shadow-sm">
    <div class="mb-3 flex items-center justify-between">
      <h3 class="font-medium text-gray-700">Colaboradores</h3>
      <span class="text-sm text-gray-500">{{ project.colaboradores?.length || 0 }} miembros</span>
    </div>
    <div *ngIf="project.colaboradores?.length > 0" class="grid grid-cols-2 gap-4 sm:grid-cols-3">
      <div
        *ngFor="let colab of project.colaboradores"
        class="flex items-center gap-3 rounded p-2 hover:bg-gray-50"
      >
        <div
          class="flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 font-medium text-blue-600"
        >
          {{ colab.nombre.charAt(0) }}
        </div>
        <div>
          <div class="font-medium text-gray-800">{{ colab.nombre }}</div>
          <div class="text-xs text-gray-500">{{ colab.rol || 'Colaborador' }}</div>
        </div>
      </div>
    </div>
    <div
      *ngIf="!project.colaboradores || project.colaboradores.length === 0"
      class="py-4 text-center text-gray-500"
    >
      No hay colaboradores aún
    </div>
    <!-- Botones de acción -->
    <div *ngIf="isProjectOwner" class="flex flex-col gap-4 sm:flex-row">
      <!-- Botón para abrir el modal -->
      <button
        (click)="openInviteModal()"
        class="flex-1 rounded-xl border border-transparent bg-primary px-4 py-3 text-lg font-medium text-white shadow-md transition hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
      >
        Invitar Colaboradores
      </button>
      <a
        [routerLink]="'/student/projects/' + project.id + '/colab'"
        class="flex-1 rounded-lg border border-blue-600 px-4 py-3 text-center font-medium text-blue-600 shadow-sm transition hover:bg-blue-50"
      >
        Página Colaborativa
      </a>
    </div>
  </div>
</div>
<div *ngIf="inviteGlobalError" class="mb-2 text-center font-bold text-red-600">
  {{ inviteGlobalError }}
</div>
<div *ngIf="inviteGlobalSuccess" class="mb-2 text-center font-bold text-green-600">
  {{ inviteGlobalSuccess }}
</div>
<!-- MODAL de invitación (fuera del layout principal, mejor UX) -->
<div
  *ngIf="showInviteModal"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black/40"
>
  <div class="w-full max-w-sm rounded-lg bg-white p-6 shadow-lg">
    <h3 class="mb-3 text-lg font-bold">Invitar por correo</h3>
    <form (ngSubmit)="sendInvitation()" class="space-y-4">
      <input
        type="email"
        [(ngModel)]="inviteEmail"
        name="inviteEmail"
        required
        placeholder="Correo electrónico"
        class="w-full rounded border p-2"
      />
      <div class="flex gap-2">
        <button
          type="submit"
          [disabled]="inviteLoading"
          class="flex-1 rounded bg-blue-600 py-2 text-white"
        >
          {{ inviteLoading ? 'Enviando...' : 'Enviar invitación' }}
        </button>
        <button type="button" (click)="closeInviteModal()" class="flex-1 rounded bg-gray-200 py-2">
          Cancelar
        </button>
      </div>
    </form>
    <div *ngIf="inviteError" class="mt-2 text-red-500">{{ inviteError }}</div>
    <div *ngIf="inviteSuccess" class="mt-2 text-green-600">{{ inviteSuccess }}</div>
  </div>
</div>

<!-- Mensaje para proyectos privados -->
<div
  *ngIf="project && !project.vista_publica && !isProjectOwner && !loading"
  class="flex min-h-[50vh] items-center justify-center"
>
  <div class="max-w-md rounded-lg border bg-white p-6 text-center shadow">
    <div class="mb-4 text-red-500">
      <svg class="mx-auto h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
        />
      </svg>
    </div>
    <h2 class="mb-4 text-xl font-semibold text-red-600">Acceso Restringido</h2>
    <p class="mb-4 text-gray-600">
      Este proyecto es privado y solo los colaboradores pueden verlo.
    </p>
    <button *ngIf="!currentUserId" class="text-blue-600 hover:underline">Solicitar acceso</button>
  </div>
</div>
